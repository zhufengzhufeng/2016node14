###$watch
- 监控作用域值的变化
```
CSS:<body ng-controller="ctrl">
    <input type="text" ng-model="name"   ng-change="change()">
    <span ng-bind="age"></span>
    
Angular:
app.controller('ctrl',function ($scope) {
        //当输入的内容是偶数的时候，让age+1， 如果age增加了 监控age,如果age>10，弹层说age>10
        $scope.change=function () {
            $scope.age=1;
            //监控的第一个参数可以为作用域上的属性名或者函数。 一定是字符串的
            $scope.$watch('age',function (newVel,oldVel) {
                //age 发生变化就会触发。
                //newVel:改变后的值，oldVel:原来的值
                if(newVel>4){
                    alert('大于4了。')
                }
            });
            if($scope.name%2==0){
                $scope.age++;
            }
        };
```

###$apply() 
- 如果不是angular提供的方法，当数据发生改变，不会刷新视图。需要调用apply()来提醒angular更新视图。
```
<script>
    var app = angular.module('appModule',[]);
    app.controller('ctrl',function ($scope,$interval,$timeout) {
        var timer=  $interval(function () {
           $scope.date=Date.now();
            $interval(timer)
        },1000); // angular提供的服务，会自动调用$apply方法，不需要手动调用。
        //$watch + $apply 就实现了事件的双重绑定
        
         /*setInterval(function () {
                    $scope.date=Date.now();
                    //不是angular 中的方法，会执行，但是不会刷新试图
                    $scope.$apply();
                    //告诉angular 数据发生改变，刷新视图
                },1000)*/
    });
</script>
```
##ES6 箭头函数
- ()=>{}
> ES6中，箭头函数中没有this属性，所以箭头函数中的this都是指向其父级中的this。



##服务
###Provider
- 最大的服务，可以配置
- new函数》config》$get
- 默认provider会被实例化
- 当我们在控制器中使用provider的时候，会调用他的$get方法
```
app.config(function(CalcProvider){
    CalcProvider.age=10
})

app.provider('Calc',funciton(){
    this.age=8;
    this.$get = function(){
        return {a:1}   
    }
})

app.controller('oneCtrl', function ($scope, Wzp) {
        console.log(Wzp["+"](1, 2));
    });
```

### factory
- 后面的函数是provider中的$get
- factory不支持配置，因为配置实在factory之前执行的也就没有意义，factory是基于provider的
```
app.factory('Cac1',function () {  
        this.currency='$';
            return {
                "+":(a,b)=>{
                    return this.currency+(a+b)
                }
            }
    });

app.controller('oneCtrl',function ($scope,Cac1) {
        console.log(Cac1["+"](1,2))
    });
```

###service
- service是基于factory的
- factory返回的对象是service函数实例化后的结果
- this指实例，Cacl
```
app.service('Cac1',function () {
        //this指实例，Cacl
        this['+']=(a,b)=>a+b;
        this['-']=(a,b)=>a-b;
        /*return {
            "+":(a,b)=>{
                return this.currency+(a+b)
            }
         "-":(a,b)=>{
         return this.currency+(a-b)
         }
        }*/
    });

     app.controller('oneCtrl',function ($scope,Cac1) {
        console.log(Cac1["+"](1,2))
    });
```
### value
- 调用的是factory
- 值简单的时候用value和constant，用法一样
```
app.value('Cac1',{
         "+":(a,b)=>a+b,
         "-":(a,b)=>a-b

    });
    app.controller('oneCtrl',function ($scope,Cac1) {
        console.log(Cac1["+"](1,2))
    });
```

###constant 同value


##事件
控制器可以进行交互的三种方式：$rootScope, 服务, 事件
- $on: 监听
- $emit: 向上传输值(包括自己)
- $broadcast: 向下传输值(包括自己) 
例题：
```
CSS:<div ng-controller="parent">
        <input type="text" ng-model="total">
        <div ng-controller="child">
            {{name}} <br>
            {{price}} <br>
            <input type="text" ng-model="count">
        </div>
    </div>
    
Angular:
<script>
    //交互方式 $on 监听 $emit 向上传递并且包括自己  $broadcast 向下传递并且包括自己
    var app = angular.module('appModule',[]);
    app.controller('parent',function ($scope) {
        //$scope.total = 10;
        $scope.$on('爸爸我买了雪碧',function (e,data) {
            $scope.total = data
        });
        $scope.$watch('total',function () {
            $scope.$broadcast('给钱',$scope.total)
        })

    });
    app.controller('child',function ($scope) {
        $scope.name = '雪碧';
        $scope.price = 2.5;
        $scope.count = 4;
        $scope.$watch('count',function () {
            //当数量变化的时候 向上发射
            $scope.$emit('爸爸我买了雪碧',$scope.count*$scope.price);
        });
        $scope.$on('给钱',function (e,data) {
          $scope.count=data/$scope.price
        })
    });
</script>
```