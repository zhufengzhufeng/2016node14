<!DOCTYPE html><html><head><title>angular指令</title><meta charset='utf-8'><link href='https://dn-maxiang.qbox.me/res-min/themes/marxico.css' rel='stylesheet'><style>
.note-content  {font-family: 'Helvetica Neue', Arial, 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Song, sans-serif;}

</style></head><body><div id='preview-contents' class='note-content'>
                        
                    



<h3 id="angular指令">angular指令</h3>

<ol><li rel="1">指令不依赖于控制器</li>
<li rel="2">指令不会默认产生作用域，但是可以声明作用域，ng-repeat会创建作用域</li>
<li rel="3">指令的格式：</li>
</ol>



<ul><li>属性:Attribute A</li>
<li></li>
</ul>



<pre class="prettyprint hljs-dark"><code class="hljs apache"><span class="hljs-tag">&lt;div drag&gt;</span><span class="hljs-tag">&lt;/div&gt;</span><br></code></pre>

<ul><li>元素：Element E</li>
</ul>



<pre class="prettyprint hljs-dark"><code class="hljs apache"><span class="hljs-tag">&lt;drag&gt;</span><span class="hljs-tag">&lt;/drag&gt;</span><br></code></pre>

<ul><li>类：Class C</li>
</ul>



<pre class="prettyprint hljs-dark"><code class="hljs applescript">&lt;<span class="hljs-keyword">div</span> <span class="hljs-type">class</span>=<span class="hljs-string">"drag"</span>&gt;&lt;/<span class="hljs-keyword">div</span>&gt;<br></code></pre>

<ul><li>注释：Comment M</li>
</ul>



<pre class="prettyprint hljs-dark"><code class="hljs xml"><span class="hljs-comment">&lt;!-- directive:drag --&gt;</span><br></code></pre>

<ol start="4"><li rel="4">指令分为2种： <br>
<ul>
<li>装饰性指令：负责添加功能，例如拖拽</li>
<li>组件式：替换成完整的组件</li></ul></li>
</ol>



<pre class="prettyprint hljs-dark"><code class="hljs less"><span class="hljs-tag">add</span><span class="hljs-class">.directive</span>(<span class="hljs-string">'myDrag'</span>,<span class="hljs-function">function</span>(){<br>     <span class="hljs-tag">return</span>{<br>            <span class="hljs-attribute">restrict</span>:<span class="hljs-string">'ECMA'</span>,<br>            <span class="hljs-attribute">replace</span>:true,<br>            <span class="hljs-attribute">templace</span>:<span class="hljs-built_in">`&lt;div&gt;&lt;h1&gt;hello&lt;/h1&gt;&lt;span&gt;你好&lt;span&gt;&lt;/div&gt;`</span><br>      }<br>})<br></code></pre>

<blockquote>
  <ol><li rel="1">命名规范：在html中，多个单词以短线链接，在js中改为驼峰命名法</li>
  <li rel="2">restrict：限制生效范围</li>
  <li rel="3">replace：把原有的标签替换掉，要求模板必须有一个根节点（上边的div）</li>
  <li rel="4">只要涉及到模板，外边就要有一个根节点div</li>
  <li rel="5">有template的都是组件式的</li>
  </ol>
</blockquote>



<h4 id="装饰性">装饰性</h4>

<ol start="1"><li rel="1">在angular中，我们不操作dom，而是操作link，连接作用域和视图</li>
</ol>



<pre class="prettyprint hljs-dark"><code class="hljs delphi">&lt;<span class="hljs-keyword">div</span> color-red&gt;&lt;<span class="hljs-keyword">div</span>&gt;<br>link:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(scope,element,attr)</span><span class="hljs-comment">{<br><br>}</span></span><br></code></pre>

<blockquote>
  <ol><li rel="1">scope:当前指令所在的作用域，指令没有创建作用域，所以使用的是上一级，在这里指令是color-red，作用域是div</li>
  <li rel="2">element：当前指令所在的元素（div），这里是jq对象，所以要使用jq方法，angular中需要加单位</li>
  <li rel="3">angular中的this：angular.element(this)=$(this)</li>
  <li rel="4">attr:当前指令上的所有属性</li>
  </ol>
</blockquote>

<ol start="2"><li rel="2">特点：可以复用，不会覆盖</li>
<li rel="3">想用jq写代码的时候，需要先引入jq包，再引入angular</li>
</ol>



<h4 id="组件式">组件式</h4>

<ol start="1"><li rel="1">在angular中，我们要用到一些复杂的模板，为了防止代码的冗余，需要把他们写在另一个页面中，通过指令引入</li>
</ol>



<pre class="prettyprint hljs-dark"><code class="hljs less"><span class="hljs-attribute">templateUrl</span>:<span class="hljs-built_in">`panel.html`</span><br></code></pre>

<ol start="2"><li rel="2">用了模板的内容，但还想保留原有标签中的内容,指定放在哪个位置，要放在哪个标签上就在哪里写指令ng-transclude</li>
</ol>



<pre class="prettyprint hljs-dark"><code class="hljs groovy"><span class="hljs-string">tanslclude:</span><span class="hljs-literal">true</span><br></code></pre>

<ol start="3"><li rel="3">创建一个独立的作用域 <br>
<ul>
<li>默认不产生作用域，而且拥有父子关系</li></ul></li>
</ol>



<pre class="prettyprint hljs-dark"><code class="hljs d"><span class="hljs-keyword">scope</span>:<span class="hljs-literal">true</span>;<br><span class="hljs-keyword">scope</span>:{}<br></code></pre>

<ul><li>这两个区别： <br>
<ul>
<li>true：可以不断绝父子关系，仍然可以向上级查找</li>
<li>{}：断绝了父子关系，可以认为与$rootScope同级</li></ul></li>
</ul>



<h4 id="传递数据">传递数据</h4>

<ol start="1"><li rel="1">传递一些数据，可以通过属性传递，attr，props</li>
</ol>



<pre class="prettyprint hljs-dark"><code class="hljs livecodeserver">html中的标签：<br>&lt;panel title=<span class="hljs-string">'这是标签1'</span>&gt;内容一&lt;/panel&gt;<br>&lt;panel title=<span class="hljs-string">'这是标签2'</span>&gt;内容二&lt;/panel&gt;<br><br><br>script中：<br>app.directive(<span class="hljs-string">'panel'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> () {</span><br>        <span class="hljs-constant">return</span> {<br>            restrict: <span class="hljs-string">'E'</span>,<br>           <span class="hljs-comment"> //封装好一个组件可以多次调用</span><br>            templateUrl: `<span class="hljs-number">4</span>(<span class="hljs-number">2</span>).panel.html`,<br>            transclude: <span class="hljs-constant">true</span>,<br>            link: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-title">scope</span>, <span class="hljs-title">element</span>, <span class="hljs-title">attr</span>) {</span><br>               <span class="hljs-comment"> //目的：想拿到属性中的值放在heading中</span><br>                scope.title = attr.title<span class="hljs-comment">;//将数据挂载在作用域上，可以通过{{}}来获取</span><br>            },<br>            scope: <span class="hljs-constant">true</span><span class="hljs-comment">,//产生独立作用域</span><br>           <span class="hljs-comment"> //            scope:{}//产生独立作用域</span><br>        }<br>    })<br><br><span class="hljs-number">4</span>(<span class="hljs-number">2</span>).panel.html中：<br>&lt;<span class="hljs-operator">div</span> class=<span class="hljs-string">"panel panel-danger"</span>&gt;<br>    &lt;<span class="hljs-operator">div</span> class=<span class="hljs-string">"panel-heading"</span>&gt;{{title}}&lt;/<span class="hljs-operator">div</span>&gt;<br>    &lt;<span class="hljs-operator">div</span> class=<span class="hljs-string">"panel-body"</span> ng-transclude&gt;&lt;/<span class="hljs-operator">div</span>&gt;<br>    &lt;<span class="hljs-operator">div</span> class=<span class="hljs-string">"panel-footer"</span>&gt;&lt;/<span class="hljs-operator">div</span>&gt;<br>&lt;/<span class="hljs-operator">div</span>&gt;<br><br></code></pre>

<ol start="2"><li rel="2">传递字符串@</li>
</ol>



<pre class="prettyprint hljs-dark"><code class="hljs actionscript">html中的标签：<br>&lt;panel title=<span class="hljs-string">'这是标签1'</span>&gt;内容一&lt;/panel&gt;<br><br><br>script中：<br><span class="hljs-keyword">var</span> app = angular.module(<span class="hljs-string">'appModule'</span>, []);<br>    app.directive(<span class="hljs-string">'panel'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{<br>        <span class="hljs-keyword">return</span> {<br>            restrict: <span class="hljs-string">'E'</span>,<br>            templateUrl: `<span class="hljs-number">4</span>(<span class="hljs-number">2</span>).panel.html`,<br>            transclude: <span class="hljs-literal">true</span>,<br>            link: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(scope, element, attr)</span> </span>{<br>            },<br>            scope:{ <span class="hljs-comment">//scope.title='zfpx1',声明的的是一个字符串，和外边的</span><br>                title:<span class="hljs-string">'@'</span>,<span class="hljs-comment">//@：取的是title对应的字符串,相同的可以去掉纳</span><br><span class="hljs-comment">//                title:'@tit'</span><br>            }<br>        }<br>    })<br></code></pre>

<ul><li>根作用域上的方法左右的作用域都可以用，但是独立作用域中的值的变化不会影响根作用域的值，而根作用域的值的变化会影响独立作用域中的值，由此可以知道@的数据绑定是单向的</li>
</ul>



<pre class="prettyprint hljs-dark"><code class="hljs xquery">html中：<br> &lt;input type=<span class="hljs-string">"text"</span> ng-model=<span class="hljs-string">"title"</span>&gt;<br>            &lt;panel title=<span class="hljs-string">"{{title}}"</span>&gt;内容一&lt;/panel&gt;<br><br><br>script中：<br>app.run([<span class="hljs-string">'$rootScope'</span>,<span class="hljs-keyword">function</span> (<span class="hljs-variable">$rootScope</span>) {<br>        <span class="hljs-variable">$rootScope</span>.title=<span class="hljs-string">'zfpx'</span><br>    }]);<br>    app.directive(<span class="hljs-string">'panel'</span>, <span class="hljs-keyword">function</span> () {<br>        return {<br>            restrict: <span class="hljs-string">'E'</span>,<br>            templateUrl: `<span class="hljs-number">6</span>(<span class="hljs-number">2</span>)panel.html`,<br>            transclude: true,<br>            link: function (scope, element, attr) {<br>            },<br>            scope:{ //scope.title=<span class="hljs-string">'zfpx1'</span>,声明的的是一个字符串，和外边的作用域没有关系<br>                title:<span class="hljs-string">'@'</span>,<br>            }<br>        }<br>    })<br></code></pre>



<pre class="prettyprint hljs-dark"><code class="hljs applescript">&lt;<span class="hljs-keyword">div</span> <span class="hljs-type">class</span>=<span class="hljs-string">"panel panel-danger"</span>&gt;<br>    &lt;<span class="hljs-keyword">div</span> <span class="hljs-type">class</span>=<span class="hljs-string">"panel-heading"</span>&gt;{{title}}&lt;/<span class="hljs-keyword">div</span>&gt;<br>    &lt;<span class="hljs-keyword">div</span> <span class="hljs-type">class</span>=<span class="hljs-string">"panel-body"</span> ng-transclude&gt;&lt;/<span class="hljs-keyword">div</span>&gt;<br>    &lt;<span class="hljs-keyword">div</span> <span class="hljs-type">class</span>=<span class="hljs-string">"panel-footer"</span>&gt;&lt;input type=<span class="hljs-string">"text"</span> ng-model=<span class="hljs-string">"title"</span>&gt;&lt;/<span class="hljs-keyword">div</span>&gt;<br>&lt;/<span class="hljs-keyword">div</span>&gt;<br></code></pre>

<ol start="3"><li rel="3">传递变量 =</li>
</ol>



<ul><li>改变任意作用域中的只都会改变另一个作用域上的值，由此可以看出=的数据绑定是双向的</li>
<li></li>
</ul>



<pre class="prettyprint hljs-dark"><code class="hljs xquery">html中：<br>&lt;input type=<span class="hljs-string">"text"</span> ng-model=<span class="hljs-string">"title"</span>&gt;<br>            &lt;panel title=<span class="hljs-string">"title"</span>&gt;内容一&lt;/panel&gt;<br><br><br>script中：<br>app.run([<span class="hljs-string">'$rootScope'</span>,<span class="hljs-keyword">function</span> (<span class="hljs-variable">$rootScope</span>) {<br>        <span class="hljs-variable">$rootScope</span>.title=<span class="hljs-string">'zfpx'</span><br>    }])<br>    app.directive(<span class="hljs-string">'panel'</span>, <span class="hljs-keyword">function</span> () {<br>        return {<br>            restrict: <span class="hljs-string">'E'</span>,<br>            templateUrl: `<span class="hljs-number">4</span>(<span class="hljs-number">2</span>).panel.html`,<br>            transclude: true,<br>            link: function (scope, element, attr) {<br>            },<br>            scope:{<br>                title:<span class="hljs-string">'='</span>,<br>            }<br>        }<br>    })<br></code></pre>

<ol start="4"><li rel="4">传递方法 &amp;</li>
</ol>



<ul><li>指令中有独立作用域，能直接调用父级的方法，要通过属性传递到指令中，传递的时候需要用（属性=”作用域中的方法()”，指令中用&amp;来接收）</li>
<li></li>
</ul>



<pre class="prettyprint hljs-dark"><code class="hljs xquery">html中：<br>&lt;!--这里是形参--&gt;<br>&lt;panel ss=<span class="hljs-string">"say(a,b)"</span>&gt;内容一&lt;/panel&gt;<br><br><br>script中：<br>app.run([<span class="hljs-string">'$rootScope'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-variable">$rootScope</span>) {<br>        /*这里是形参*/<br>        <span class="hljs-variable">$rootScope</span>.say = function (a,b) {<br>            alert(a);<br>            alert(b)<br>        }<br>    }]);<br>    app.directive(<span class="hljs-string">'panel'</span>, <span class="hljs-keyword">function</span> () {<br>        return {<br>            restrict: <span class="hljs-string">'E'</span>,<br>            /*这里是实参*/<br>            template: `&lt;button ng-click=<span class="hljs-string">"s({a:'你好',b:'不好'})"</span>&gt;say&lt;/button&gt;`,<br>            transclude: true,<br>            scope: {<br>                s: <span class="hljs-string">'&amp;ss'</span>,<br>            }<br>        }<br>    })<br></code></pre>



<h4 id="其他指令">其他指令</h4>

<ol><li rel="1">ng-hide和ng-show操作的是样式</li>
<li rel="2">ng-if操作的是dom元素，会产生一个作用域，如果if为false，则内部代码消失，内部代码不执行</li>
</ol>



<h3 id="服务">服务</h3>

<ol start="1"><li rel="1">provide <br>
<ul>
<li>最大的服务，可以配置</li>
<li>new函数》config》$get</li>
<li>默认provider会被实例化</li>
<li>当我们在控制器中使用provider的时候，会调用他的$get方法</li></ul></li>
</ol>



<pre class="prettyprint hljs-dark"><code class="hljs actionscript">app.config(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Cac1Provider)</span></span>{<br><span class="hljs-comment">//Cac1Provider是Cacl是声明的函数的实例</span><br>        Cac1Provider.currency=<span class="hljs-string">'RMB'</span>;<span class="hljs-comment">//会等provider创建好实例再进行配置，先执行provider，在执行config</span><br>    })<br><br><br>    app.provider(<span class="hljs-string">'Cac1'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{  <span class="hljs-comment">//函数是服务的定义</span><br>        <span class="hljs-keyword">this</span>.currency=<span class="hljs-string">'$'</span>;<br>        <span class="hljs-keyword">this</span>.$<span class="hljs-keyword">get</span>=<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{<br>            <span class="hljs-keyword">return</span> {  <span class="hljs-comment">//返回的对象是公用的</span><br>                <span class="hljs-string">"+"</span>:(a,b)=&gt;{<br>                        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.currency+(a+b)<br>                    }<br>            }<br>        }<br>    });<br><br><br>    app.controller(<span class="hljs-string">'oneCtrl'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($scope,Cac1)</span> </span>{  <span class="hljs-comment">//Cacl是指return返回的对象</span><br>        console.log(Cac1[<span class="hljs-string">"+"</span>](<span class="hljs-number">1</span>,<span class="hljs-number">2</span>))<br>    });<br></code></pre>

<ol start="2"><li rel="2">factory <br>
<ul>
<li>后面的函数是provider中$get方法中对应的</li>
<li>后面的函数就是$get函数</li>
<li>factory不支持配置，因为配置实在factory之前执行的也就没有意义，factory是基于provider的</li></ul></li>
</ol>



<pre class="prettyprint hljs-dark"><code class="hljs javascript">app.factory(<span class="hljs-string">'Cac1'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{  <br>        <span class="hljs-keyword">this</span>.currency=<span class="hljs-string">'$'</span>;<br>            <span class="hljs-keyword">return</span> {<br>                <span class="hljs-string">"+"</span>:(a,b)=&gt;{<br>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.currency+(a+b)<br>                }<br>            }<br>    });<br><br><br>    app.controller(<span class="hljs-string">'oneCtrl'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$scope,Cac1</span>) </span>{<br>        <span class="hljs-built_in">console</span>.log(Cac1[<span class="hljs-string">"+"</span>](<span class="hljs-number">1</span>,<span class="hljs-number">2</span>))<br>    });<br></code></pre>

<ol start="3"><li rel="3">service <br>
<ul>
<li>service是基于factory的</li>
<li>factory返回的对象是service函数实例化后的结果</li>
<li>this指实例，Cacl</li></ul></li>
</ol>



<pre class="prettyprint hljs-dark"><code class="hljs javascript">app.service(<span class="hljs-string">'Cac1'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{<br>        <span class="hljs-comment">//this指实例，Cacl</span><br>        <span class="hljs-keyword">this</span>[<span class="hljs-string">'+'</span>]=(a,b)=&gt;a+b;<br>        <span class="hljs-keyword">this</span>[<span class="hljs-string">'-'</span>]=(a,b)=&gt;a-b;<br>        <span class="hljs-comment">/*return {<br>            "+":(a,b)=&gt;{<br>                return this.currency+(a+b)<br>            }<br>         "-":(a,b)=&gt;{<br>         return this.currency+(a-b)<br>         }<br>        }*/</span><br>    });<br><br>     app.controller(<span class="hljs-string">'oneCtrl'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$scope,Cac1</span>) </span>{<br>        <span class="hljs-built_in">console</span>.log(Cac1[<span class="hljs-string">"+"</span>](<span class="hljs-number">1</span>,<span class="hljs-number">2</span>))<br>    });<br></code></pre>

<ol start="4"><li rel="4">value <br>
<ul>
<li>调用的是factory</li>
<li>值简单的时候用value和constant，用法一样</li></ul></li>
</ol>



<pre class="prettyprint hljs-dark"><code class="hljs xquery">app.<span class="hljs-keyword">value</span>(<span class="hljs-string">'Cac1'</span>,{<br>         <span class="hljs-string">"+"</span>:(a,b)=&gt;a+b,<br>         <span class="hljs-string">"-"</span>:(a,b)=&gt;a-b<br><br>    });<br>    app.controller(<span class="hljs-string">'oneCtrl'</span>,<span class="hljs-keyword">function</span> (<span class="hljs-variable">$scope</span>,Cac1) {<br>        console.log(Cac1[<span class="hljs-string">"+"</span>](<span class="hljs-number">1</span>,<span class="hljs-number">2</span>))<br>    });<br></code></pre>



<h3 id="watch">$watch</h3>

<ol><li rel="1">作用：监控</li>
<li rel="2"><ul>
<li>param1：作用域上的属性名，可以使字符串，也可以是函数（只要页面中任意一个值变化就会执行，将函数返回的结果传递到第二个参数中）</li>
<li>param2：函数</li></ul></li>
</ol>



<pre class="prettyprint hljs-dark"><code class="hljs xquery">param1为函数：<br><br>app.controller(<span class="hljs-string">'myCtrl'</span>,<span class="hljs-keyword">function</span> (<span class="hljs-variable">$scope</span>) {<br>       <span class="hljs-variable">$scope</span>.<span class="hljs-variable">$watch</span>(<span class="hljs-variable">$scope</span>.sum=function () {<br>            return <span class="hljs-variable">$scope</span>.product.count*<span class="hljs-variable">$scope</span>.product.price;<br>        },function (newVal) {<br>            if(newVal&gt;=<span class="hljs-number">100</span>){<br>                <span class="hljs-variable">$scope</span>.product.free=<span class="hljs-number">0</span>;<br>            }<br>        })<br><br><br>param1为字符串：<br><br><span class="hljs-variable">$scope</span>.<span class="hljs-variable">$watch</span>(<span class="hljs-string">'sum()'</span>,function (newVal,oldVal) {<br>            if(newVal&gt;=<span class="hljs-number">40</span>){<br>                <span class="hljs-variable">$scope</span>.product.free=<span class="hljs-number">0</span>;<br>            }<br>        })<br></code></pre>



<h3 id="apply">$apply</h3>

<ol start="1"><li rel="1">作用：不是angular中的方法，改变数据不会刷新视图，此时就用$apply进行强行刷新试图</li>
</ol>



<pre class="prettyprint hljs-dark"><code class="hljs xquery">&lt;body ng-controller=<span class="hljs-string">"myCtrl"</span>&gt;<br>{{date | date:<span class="hljs-string">'hh:mm:ss'</span>}}<br>&lt;script src=<span class="hljs-string">"node_modules/angular/angular.js"</span>&gt;&lt;/script&gt;<br>&lt;script&gt;<br>    var app=angular.module(<span class="hljs-string">'appModule'</span>,[]);<br>    app.controller(<span class="hljs-string">'myCtrl'</span>,<span class="hljs-keyword">function</span> (<span class="hljs-variable">$scope</span>) {<br>        setInterval(function () {<br>            <span class="hljs-variable">$scope</span>.date=Date.now();<br>            <span class="hljs-variable">$scope</span>.<span class="hljs-variable">$apply</span>();<br>        },<span class="hljs-number">1000</span>)<br>    })<br></code></pre>

<ol start="2"><li rel="2">angular中提供的服务，都可以自动调用$apply（），不需要手动调用，\$watch+\$apply可以实现双向绑定</li>
</ol>



<pre class="prettyprint hljs-dark"><code class="hljs xquery">app.controller(<span class="hljs-string">'myCtrl'</span>,<span class="hljs-keyword">function</span> (<span class="hljs-variable">$scope</span>,<span class="hljs-variable">$interval</span>) {<br>        <span class="hljs-variable">$interval</span>(function () {<br>            <span class="hljs-variable">$scope</span>.date=Date.now();<br>        },<span class="hljs-number">1000</span>)<br>    })<br></code></pre>



<pre class="prettyprint hljs-dark"><code class="hljs xquery">app.controller(<span class="hljs-string">'myCtrl'</span>,<span class="hljs-keyword">function</span> (<span class="hljs-variable">$scope</span>,<span class="hljs-variable">$interval</span>,) {<br>        var timer=<span class="hljs-variable">$interval</span>(function () {<br>            <span class="hljs-variable">$scope</span>.date=Date.now();<br>            //取消定时器<br>            <span class="hljs-variable">$interval</span>.cancel(timer)<br>        },<span class="hljs-number">1000</span>)<br>    })<br></code></pre>



<h3 id="控制器交互">控制器交互</h3>

<ol><li rel="1">控制器可以进行交互，可以通过： <br>
<ul>
<li>$rootScope</li>
<li>服务</li>
<li>通过事件</li></ul></li>
<li rel="2">交互的方法有： <br>
<ul>
<li>$on（监听）</li>
<li>$emit（向上发射，并且包括自己）</li>
<li>$broadcast （向下发射，并且包括自己）</li></ul></li>
</ol>

<p><strong>父子级交互</strong></p>



<pre class="prettyprint hljs-dark"><code class="hljs xquery">儿子的控制器：<br><span class="hljs-variable">$scope</span>.<span class="hljs-variable">$watch</span>(<span class="hljs-string">'count'</span>,<span class="hljs-keyword">function</span>(){<br>        <span class="hljs-variable">$scope</span>.<span class="hljs-variable">$emit</span>(<span class="hljs-string">'爸爸付钱'</span>,<span class="hljs-variable">$scope</span>.count*<span class="hljs-variable">$scope</span>.price)<br>})<br></code></pre>

<ul><li>儿子的监控器监控自己的数量区的变化，当他变化了，就把公式传递给父亲，让他执行</li>
</ul>



<pre class="prettyprint hljs-dark"><code class="hljs xquery"><br>父亲的控制器：<br><span class="hljs-variable">$scope</span>.<span class="hljs-variable">$on</span>(<span class="hljs-string">'爸爸付钱'</span>,<span class="hljs-keyword">function</span>(e,data){<br>        <span class="hljs-variable">$scope</span>.total=data;<br>})<br></code></pre>

<ul><li>父亲得到了儿子的请求，把data（儿子上边公式的值）赋值到需要改变的变量上</li>
</ul>

<p><strong>平级交互</strong></p>

<ul><li>直接都向上发射到根作用域</li>
</ul>



<pre class="prettyprint hljs-dark"><code class="hljs xquery">app.controller(<span class="hljs-string">'brother'</span>,<span class="hljs-keyword">function</span> (<span class="hljs-variable">$scope</span>,<span class="hljs-variable">$rootScope</span>) {<br>        <span class="hljs-variable">$scope</span>.<span class="hljs-variable">$watch</span>(<span class="hljs-string">'total'</span>,function () {<br>            <span class="hljs-variable">$scope</span>.<span class="hljs-variable">$emit</span>(<span class="hljs-string">'mai'</span>,<span class="hljs-variable">$scope</span>.total)<br>        })<br>        <span class="hljs-variable">$rootScope</span>.<span class="hljs-variable">$on</span>(<span class="hljs-string">'付钱'</span>,function (e,data) {<br>            <span class="hljs-variable">$scope</span>.total=data;<br>        });<br>    });<br>    app.controller(<span class="hljs-string">'sister'</span>,<span class="hljs-keyword">function</span> (<span class="hljs-variable">$scope</span>,<span class="hljs-variable">$rootScope</span>) {<br>        <span class="hljs-variable">$scope</span>.name=<span class="hljs-string">'可乐'</span>;<br>        <span class="hljs-variable">$scope</span>.price=<span class="hljs-number">2.5</span>;<br>        <span class="hljs-variable">$scope</span>.count=<span class="hljs-number">4</span>;<br>        <span class="hljs-variable">$scope</span>.<span class="hljs-variable">$watch</span>(<span class="hljs-string">'count'</span>,function () {<br>            <span class="hljs-variable">$scope</span>.<span class="hljs-variable">$emit</span>(<span class="hljs-string">'付钱'</span>,<span class="hljs-variable">$scope</span>.count*<span class="hljs-variable">$scope</span>.price)<br>        })<br>        <span class="hljs-variable">$rootScope</span>.<span class="hljs-variable">$on</span>(<span class="hljs-string">'mai'</span>,function (e,data) {<br>            <span class="hljs-variable">$scope</span>.count=data/<span class="hljs-variable">$scope</span>.price<br>        })<br>    })<br></code></pre></div></body></html>